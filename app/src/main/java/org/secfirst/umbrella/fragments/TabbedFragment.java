package org.secfirst.umbrella.fragments;

import android.app.Activity;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.graphics.drawable.Drawable;
import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentManager;
import android.support.v4.app.FragmentPagerAdapter;
import android.support.v4.view.ViewPager;
import android.text.Html;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.ListView;
import android.widget.ProgressBar;
import android.widget.TextView;
import android.widget.Toast;

import org.secfirst.umbrella.BuildConfig;
import org.secfirst.umbrella.MainActivity;
import org.secfirst.umbrella.R;
import org.secfirst.umbrella.adapters.CheckListAdapter;
import org.secfirst.umbrella.models.CheckItem;
import org.secfirst.umbrella.models.Segment;
import org.secfirst.umbrella.util.Global;

import java.util.List;
import java.util.Locale;

public class TabbedFragment extends Fragment {

    public static final String ARG_DIFFICULTY_NUMBER = "spinner_number";
    SectionsPagerAdapter mSectionsPagerAdapter;
    ViewPager mViewPager;
    public static int difficulty;
    public long sectionNumber;

    public static TabbedFragment newInstance(long sectionNumber, int spinnerNumber) {
        TabbedFragment tabbedFragment = new TabbedFragment();
        Bundle args = new Bundle();
        tabbedFragment.sectionNumber = sectionNumber;
        difficulty = spinnerNumber;
        tabbedFragment.setArguments(args);
        return tabbedFragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View v = inflater.inflate(R.layout.fragment_tabbed, container, false);
        mSectionsPagerAdapter = new SectionsPagerAdapter(getChildFragmentManager());
        mSectionsPagerAdapter.difficulty = difficulty;
        mViewPager = (ViewPager) v.findViewById(R.id.pager);
        mViewPager.setAdapter(mSectionsPagerAdapter);
        return v;
    }

    @Override
    public void onAttach(Activity activity) {
        super.onAttach(activity);
    }

    public class SectionsPagerAdapter extends FragmentPagerAdapter {

        public int difficulty;

        public SectionsPagerAdapter(FragmentManager fm) {
            super(fm);
        }

        @Override
        public Fragment getItem(int position) {
            Fragment fragment;
            Bundle args = new Bundle();
            if (position==0) {
                fragment = new TabbedContentFragment();
            } else {
                fragment = new CheckItemFragment();
            }
            args.putInt(TabbedFragment.ARG_DIFFICULTY_NUMBER, difficulty + 1);
            fragment.setArguments(args);
            return fragment;
        }

        @Override
        public int getCount() {
            return 2;
        }

        @Override
        public CharSequence getPageTitle(int position) {
            Locale l = Locale.getDefault();
            switch (position) {
                case 0:
                    return getString(R.string.section1_tab_title1).toUpperCase(l);
                case 1:
                    return getString(R.string.section1_tab_title3).toUpperCase(l);
            }
            return null;
        }
    }

    public static class TabbedContentFragment extends Fragment {

        private List<Segment> mSegments;
        private TextView content;
        private static String[][] contentHtml = {{},{}, {},
                {
                        "<h1>Keep what you need</h1><p>The most basic rule for managing information securely is that any information that could put people at risk should always be compartmentalised and kept ‘need to know’. This means that only those people who really need that piece of information to operate should be given it. For example, if a team is working with a high-risk source, only the source’s direct contact within the team should have his or her real name and details – the rest of the team can operate using a code name. This reduces the risk for both the source and those other members of the team.</p><img src=\"managing_information1\"><p>If there is not a good reason to keep a piece of sensitive information then you should simply delete it (see the Safely Deleting lesson).</p><h1>Threat Modelling</h1><p>There is no single solution for keeping your information safe. Managing your information securely isn’t about which tools you use; it’s about understanding the threats you face and how you can counter those threats. To become more secure, you should figure out what you need to protect, and whom you need to protect it from. Threats can change depending on where you’re located, what you’re doing, and whom you’re working with. The easiest way to figure out what solutions are best for you is to carry out a threat modelling assessment.</p><img src=\"managing_information2\"><p>When carrying out an assessment, there are five main questions you should ask yourself:</p><h2>1. What do you want to protect?</h2><p>What information could put you, your work or others at risk if were public? This is often the kind of information kept in your emails, contact lists, messages and files. It might relate to a specific sensitive campaign you are working on.</p><h2>2. Who do you want to protect it from?</h2><p>This could be any person or entity that poses a threat against an your or your work, also known as an adversary. Think about who would have a motive in reading or deleting your information or disrupting your work. Examples could be a government, a company you are exposing, your boss, or a hacker.</p><h2>3. How likely is it that you will need to protect it?</h2><p>It is important to distinguish between threats and risks. While a threat is a bad thing that can happen, risk is the likelihood that the threat will occur. Calculating risk means figuring out the chance that a threat might actually occur – how likely is it that a threat would be carried out? You also need to think about the capability of potential attackers. For example, your mobile phone provider has access to all of your phone records and therefore has the capability to use or share that data. A hacker on an open Wi-Fi network can access your unencrypted communications. A government might have stronger capabilities.</p><h2>4. How bad are the consequences if you fail?</h2><p>The motives of adversaries differ widely, as do their attacks. A company trying to prevent the spread of a video showing their illegal activity may simply want to delete the video, whereas a government may wish to gain access to the names/details of activists it sees as a threat to the state in order to arrest or harass them.</p><h2>5. How much trouble are you willing to go through in order to try to prevent those?</h2><p>This means figuring out which threats you are going to take seriously, and which may be too rare or too harmless (or too difficult to combat) to worry about. Many people find certain threats unacceptable no matter what the risk, because the presence of the threat at any likelihood is not worth the cost. In other cases, people disregard high risks because they don't view the threat as a problem.</p><h3>RELATED LESSONS/TOOLS</h3><p>- Information Security<br>- Communications Security<br>- Network Security</p><h3>FURTHER READING</h3><p>- https://ssd.eff.org/en/module/introduction-threat-modeling<br>- Citizen Lab  - https://citizenlab.org<br>- Crypto Law Survey - http://www.cryptolaw.org<br>- OpenNet (Outlines internet restrictions) - https://opennet.net<br>- https://prism-break.org/en/<br>- DLA Piper (Data Protection Laws of the World) - http://www.dlapiperdataprotection.com</p>"
                },
                {
                        "<h1>What is malware?</h1><p>Malware, short for \"malicious software,\" is software that is used to harm computer users. It can do things like gather information, impersonate a user, gain access to other computers, or stop a computer from working. It could do this by allowing an attacker to record from a webcam and microphone, disabling anti-virus programs, recording keystrokes, copying emails and other documents, stealing passwords, and more. Most malware is criminal and is often used to obtain banking information or other valuable information. However, it is also used by governments, law enforcement agencies, and even private citizens to spy on users.</p><img src=\"malware1\"><h1>Anti-virus software</h1><p>You should always use anti-virus software on your computer and your smartphone, which are easily available to buy and download. Avast is an easy to use anti-virus program for Windows. Clam Win is a good open source alternative.  Anti-virus software can be quite effective at combatting cheap, “non targeted” malware that might be used by criminals against hundreds of targets. However such software is usually ineffective against targeted attacks, such as ones carried out by governments against.</p><h1>How can I tell if my computer is compromised?</h1><p>Malware is very difficult to detect. Scanners such as Spybot or Malwarebytes can detect and protect against some malware threats and are useful to use.<br>While most malware avoids detection by software, it is still sometimes possible to find indicators of it on your computer. For example, services will sometimes send you a warning email if they believe your account has been targeted, you may notice a light indicating that your webcam is turned on when you have not activated it yourself, or your settings have been altered to send copies of your emails to an unfamiliar email address.</p><img src=\"malware2\"><h1>How can attackers use malware to target me?</h1><p>The most common method of attack is to trick you into installing the malware yourself. There are many ways they try to do this.<br>- They may disguise the malware as a link to a website, a document, a software update, or even a program designed to help secure your computer.<br>- You may be targeted via email (which may look as if it’s coming from someone you know), via a message on Skype or Twitter, or even via a link posted to your Facebook page.<br>You can also infect your computer by connecting infected hardware, like a USB key given to you or found near your office, or a phone connected to charge.</p><img src=\"malware3\"><p>The more targeted the attack the more they’ll try to make it look like something you want to open. For example, in Syria, pro-Assad hackers targeted members of the opposition with malware hidden in fake revolutionary documents and a fake anti-hacking tool. And in Morocco, activists were targeted with malware hidden in a document made to look as if it had been sent by an Al-Jazeera reporter, promising information about a political scandal.</p><p>There is also the possibility of someone gaining physical access to your computer to install malware themselves. You can read more about preventing against such attacks in the Organisational Security – Office section.</p><h1>How can I avoid getting infected?</h1><p>- Always make sure you are running the latest version of your software and downloading the latest security patches. Only the latest updates have the latest protections. It is a common belief that if you are running an unregistered copy of Windows, you cannot or should not accept security updates. This is not true. Always update. Secunia PSI for Windows is a free tool that will check to make sure your software is up to date.<br>- Only download software from official sites.<br>- Avoid open opening suspicious attachments (anything from someone you don’t know) or clicking on suspicious links (any links you didn’t request)<br>- If you are using Gmail, open unusual attachments in Google Drive rather than downloading them.<br>- Double check the sender’s email address if you get an email with an attachment or link you weren’t expecting, even if the email appears to be written by a friend or colleague. If something seems odd or their tone is unusual, it doesn’t hurt to email the friend to check they sent it and mention it to colleagues.<br>- Stay alert when browsing websites. Watch for browser windows that appear automatically, and read them carefully. When in doubt, you should close 'pop up windows' by clicking the X in the upper corner, rather than by clicking Cancel.<br>- Disconnect your computer from the Internet when you are not using it and shut it down completely overnight</p><img src=\"malware4\"><h1>What should I do if I find malware on my computer?</h1><p>-The first thing you should do if you find malware on your computer is unplug your computer from the Internet and stop using it immediately. Every keystroke you make may be being sent to an attacker.<br>- Log into a computer you believe is safe and change your passwords; every password that you typed on your computer while it was infected should now be considered to be compromised.<br>- You may wish to reinstall the operating system (eg Windows, Android, IOS) on your computer in order to remove the malware. This will remove most malware, but some especially sophisticated malware may persist.<br>- If you can, take your computer to a security expert, who may be able to discover more details about the malware.<br>- If you have some idea of when your computer was infected, you may reinstall files from before that date. Reinstalling files from after the date of infection may re-infect your computer.</p><img src=\"malware5\">",
                        "<h1>Tips on using anti-virus software effectively</h1><p>The beginner section gave a run through of useful anti-virus software such as Avast or Clam Win and anti-malware software such as Spybot or Malwarebytes. There are a few ways in which you can make sure you get the most out of your software.</p><img src=\"malware_adv1\"><p>- Do not run two anti-virus programs at the same time, as this might cause your computer to run extremely slowly or to crash. Uninstall one before installing another. However anti-malware software is designed to work alongside anti-virus software.<br>- Make sure that your anti-virus program updates itself regularly. Without updates it can quickly become ineffective. All of the software recommended here supports free updating.<br>- Enable your anti-virus software's 'always on' virus-detection feature if it has one. It may also be called 'Realtime Protection,' 'Resident Protection,' or something similar.<br>- Scan all of the files on your computer regularly. You don't have to do this every day but you should do it from time to time. How often may depend on the circumstances. Have you connected your computer to unknown networks recently? With whom have you been sharing USB memory sticks? Do you frequently receive strange attachments by email? Has someone else in your home or office recently had virus problems? Tools such as Avast can do this for you.</p><h1>Preventing virus or spyware infection</h1><p>- If you need to open a file from someone you don’t know well, you should save the attachment to a folder on your computer, then open the appropriate application (such as Microsoft Word or Adobe Acrobat) yourself. If you use the program's File menu to open the attachment manually, rather than double-clicking the file or allowing your email program to open it automatically, you are less likely to contract a virus.<br>- Hover over URLs and hyperlinks to check where they lead. If you're unsure about a URL, check it at VirusTotal.<br>- Before inserting removable media, such as CDs or USB sticks, into your computer, you should disable your operating system's 'AutoPlay' feature. (This is usually found under the Properties section of My Computer)<br>- Improve the security of your Web browser by preventing it from automatically running the potentially dangerous programs that are sometimes contained within webpages you visit. If you are using Mozilla Firefox, you can install the NoScript add-on.<br>- Download over an encrypted connection (usually SSL in the browser) whenever possible.<br>- Using free and open-source software significantly lowers your risk of being infected by malware. These tools are often written and updated for free by volunteers and are generally more secure than their proprietary alternatives. In particular, you should consider replacing Internet Explorer, Outlook and Microsoft Office with Firefox, Thunderbird and LibreOffice, respectively. You should also consider switching from the Microsoft Windows operating system to a more secure open-source alternative like Ubuntu or ChromeOS.</p><img src=\"malware_adv2\"><h1>Preventing untrusted network connections</h1><p>- A firewall helps to protect your computer from unauthorised connections to and from the Internet. It can also help reduce the spread of malware if you are infected.  Most operating systems have firewalls included but check to make sure they are turned on. (You can usually find this under Control Panel > Security) There are also excellent free programs such as Comodo Personal Firewall, which can help keep your computer secure.<br>- Make sure that all of the computers on your office network have a firewall installed. Read more about this in the Network Section.<br>- Only install essential programs on the computer you use for sensitive work, and make sure you get them from a reputable source. Uninstall any software that you do not use.</p><img src=\"malware_adv3\">"
                },
                {
                        "<p>Passwords are often the first and only barrier between your information and anyone who might want to read, use or destroy it without your permission.</p><p>In general, when you want to protect something - whether a house or an email account - you lock it up with a key. All keys, physical and electronic, have one thing in common: they open their locks just as effectively in the hands of somebody else. You can use the most advanced security tools, but if your password is weak, or if you allow it to fall into the wrong hands, they will not do you any good.</p><img src=\"password1\"><h1>How to make a strong password</h1><p>A password should be difficult for a computer program to guess, difficult for others to figure out, and should be chosen so as to minimise damage if someone does learn it.</p><p>- Make it long: The longer a password is, the longer takes to guess it. Use more than ten characters or ideally a long phrase or sentence. Short passwords of any kind, even totally random ones, are not strong enough for use with encryption today.<br>- Make it complex: Include upper case letters, lower case letters, numbers and symbols.<br>- Don't make it personal: Don't choose a word or phrase based on information such as your name, telephone number, child's name, pet's name, birth date, or anything else that a person could learn by doing a little research about you.<br>- Keep it secret: Do not share your password with anyone unless it is absolutely necessary. If you must share a password with a family member or colleague, you should change it to a temporary password first, share that one, then change it back when they are done using it. Often, there are alternatives to sharing a password, such as creating a separate account for each individual who needs access. Keeping your password secret also means not allowing anyone to see you typing it in.<br>- Make it unique: Avoid using the same password for more than one account. Otherwise, anyone who learns that password will gain access to even more of your sensitive information.<br>- Keep it fresh: Change your password on a regular basis, at least once every three months. The longer you keep one password, the more opportunity others have to figure it out and use it.<br>- Make it memorable: If you have to write your password down because you can't remember it, you may end up facing a whole new category of threats that could leave you vulnerable to anybody with access to your work area. If you are unable to think of a password that is long and complex but still memorable, the remembering secure passwords section, below, might be of some help. If not, you should still choose something secure, but you may need to record it using a secure password database such as KeePass, outlined in our Advanced section. Other types of password-protected files, including Microsoft Word documents, should not be trusted for this purpose, as many of them can be broken in seconds using tools that are freely available on the internet.</p><img src=\"password2\"><h1>Remembering secure passwords</h1><p>There are a few tricks that might help you create passwords that are easy to remember but very difficult to guess.</p><p>-Vary capitalisation, such as: 'My naME is Not MR. MarSter'<br>- Alter numbers and letters, such as: 'a11 w0Rk 4nD N0 p14Y'<br>- Incorporate symbols, such as: 'c@t(heR1nthery3'<br>- Use multiple languages, such as: 'Let Them Eat 1e gateaU au ch()colaT'<br>- Use acronyms: 'Are you happy today?' becomes 'rU:-)2d@y?'</p><p>A little effort to make the password more complex goes a very long way. Increasing the length of a password even just by a few characters, or by adding numbers or special characters, makes it much more difficult to crack.</p><p>You can check the strength of passwords on Passfault.</p><h1>Security Questions</h1><p>Be aware of the “security questions” (such as “What is your mother’s maiden name?” or \"What was your first pet's name?\") that websites use to confirm your identity if you do forget your password. Honest answers to many security questions are publicly discoverable facts that a can be easily found, and therefore bypass your password entirely. Instead, give fictional answers that, like your password, no one knows but you. For example, if the password question asks you your pet’s name, you may have posted photos to photo sharing sites with captions such as “Here is a photo of my cute cat, Spot!” Instead of using “Spot” as your password recovery answer, you might choose “Rumplestiltskin.”</p>",
                        "<h1>Recording passwords securely</h1><p>Our Basic section showed you how to create a strong, memorable password. However, because you need a different password for every account or service and also need to change them every few months, it can soon become difficult to remember them all. Fortunately, there are software tools to help with this – a password manager is a software application that can generate random, secure passwords for each of your accounts and record them in a portable, encrypted password database, such as KeePass.</p><img src=\"password_adv1\"><p>The password manager protects all of your passwords with a single master password so you only have to remember one thing. Of course, if you use this method, it becomes especially important that you create and remember a very secure password for KeePass, or whatever tool you choose. Whenever you need to enter a password for a specific account, you can look it up using only your master password, which makes it much easier to follow all of the suggestions above.</p><p>KeePass sits on your desktop, and it also portable, which means that you can put the database on a USB memory stick in case you need to look up a password while you are away from your primary computer.</p><p>There are few things to keep in mind when using password databases.</p><p>- If you lose or accidentally delete your only copy of a password database, you will no longer have access to any of the accounts for which it contained passwords. This makes it extremely important that you back up your KeePass database. Read our Backing Up lesson for instructions on how to do this.<br>- If you forget your KeePass master password, there is no way to recover it or the contents of the database. So, be sure to choose a master password that is both secure and memorable!</p><p>It is also crucially important to keep your password manager itself secure.</p><p>- Some password managers will offer to store your passwords “in the cloud,” which is to say, they will store your passwords encrypted on a remote server, and when you need them on a laptop or mobile, they will retrieve and decrypt them for you automatically. Password managers like this are more convenient, but the trade-off is that they are more vulnerable to attack. If you just keep your passwords on your computer, then someone who can take over your computer may be able to get hold of them. If you keep them in the cloud, your attacker may target that also. It's not usually a compromise you need to worry about unless your attacker has legal powers over the password manager company or is known for targeting companies or internet traffic.<br>- When you use a password manager, the security of your passwords and your master password is only as strong as the security of the computer where the password manager is installed and used. If your computer or device is compromised and spyware is installed, the spyware can watch you type your master password and could steal the contents of the password safe. So it's still very important to keep your computer and other devices clean of malicious software when using a password manager. You can learn more about this in the Malware lesson.</p>  <h1>Two-step authentication and one-time passwords</h1><p>Many services and software tools let you use two-step authentication. Here the idea is that in order to log in, you need to be in possession of a certain physical object: usually a mobile phone, but, in some versions, a special device called a security token. Using two-step authentication ensures that even if your password for the service is hacked or stolen, the thief won't be able to log in unless they also have control of a second device, such as your phone, and the special codes that only it can create.</p><img src=\"password_adv2\"><p>Two-step authentication using a mobile phone can be done in two ways: the service can send you an SMS text message to your phone whenever you try to log in which provides an extra security code that you need to type in. Alternatively, your phone can run an authenticator application, such as Google Authenticator, that generates security codes from inside the phone itself. This will help protect your account in situations where an attacker has your password but does not have physical access to your mobile phone.</p><p>Some services, such as Google, also allow you to generate a list of one-time passwords, also called single-use passwords. These are meant to be printed or written down on paper and carried with you.</p><p>There is no way to do this by yourself if you're using a service that doesn't offer it.</p><p>If you or your organization runs your own communications infrastructure, such as your own e-mail servers, there's freely available software that can be used to enable two-step authentication for accessing your systems. Ask your systems administrators to look for software offering an implementations of the open standard “Time-Based One-Time Passwords” or RFC 6238. See the Network Security section for more information about this.</p>  <h3>RELATED LESSONS/TOOLS</h3><p>- Backing Up<br>- Malware<br>- KeePass/X<br>- Google Authenticator</p>",
                        "<h1>Threats of Physical Harm or Imprisonment</h1><p>Finally, understand that there is always one way that attackers can obtain your password: They can directly threaten you with physical harm or detention. If you fear this may be a possibility, such as if you are going to be travelling across hostile borders with sensitive information, consider ways in which you can hide the existence of the data or device you are password-protecting, rather than trust that you will never hand over the password. One possibility is to maintain at least one computer/email/keepass account that contains largely unimportant information, whose password you can reveal quickly.</p><p>If you have good reason to believe that someone may threaten you for your passwords, it's good to make sure your devices are configured so that it won't be obvious that the account you are revealing is not the “real” one. Is your real account shown in your computer's login screen, or automatically displayed when you open a browser? If so, you may need to reconfigure things to make your account less obvious.</p><p>In such circumstances, you should also treat your password manager as a sensitive file, and hide/protect it as we describe in the Protecting Files lesson.</p><p>In some jurisdictions, such as the United States or Belgium, you may be able to legally challenge a demand for your password. In other jurisdictions, such as the United Kingdom or India, local laws allow the government to demand information is given to them. More information on safety precautions to take while travelling can be read in the Journeys lesson.</p><p>Please note that intentional destruction of evidence or obstruction of an investigation can be charged as a separate crime, often with very serious consequences. In some cases, this can be easier for the government to prove and allow for more substantial punishments than the alleged crime originally being investigated.</p><h3>RELATED LESSONS/TOOLS</h3><p>- Protecting Files<br>- Journeys</p><h3>FURTHER READING</h3><p>- EFF has detailed information for anyone travelling across U.S. borders who wishes to protect their data on their digital devices in their Defending Privacy at the U.S. Border guide.</p>"
                },
                {
                        "",
                        "<h1>How to protect the sensitive files on your computer</h1><p>Many human rights activists have sensitive information that could have serious consequences if seen by the wrong people. The Managing Information lesson can help you determine your threat model. Following the steps laid out in the Home/Office section and the Malware lesson will help you to protect your computer physically and digitally. However there may be situations where these precautions fail or you need to show your computer to someone whom you don’t want to see the files. This is why you should also protect the files themselves. You can do this by encrypting them so that only you can read them.</p><img src=\"protecting1\"><p>Encryption is a way to enhance the security of a message or file by scrambling the contents so that it can only be read by someone who has the right encryption key to unscramble it.<br>There is a good, free, open-source tool that can help you do this, called TrueCrypt. Much like a safe, TrueCrypt creates an encrypted container on your computer or hard drive, that you can put as many files as you like into.</p><p>Learn how to set-up and use TrueCrypt here.</p><h1>Tips on using file encryption safely</h1><p>There are a few things you should bear in mind when using TrueCrypt and tools like it. No matter how sturdy your safe is, it won't do you a whole lot of good if you leave the door open. When your TrueCrypt volume or container is 'mounted' (what it calls open to view your files), your data may be vulnerable, so you should keep it closed except when you are actually reading or modifying the files inside it.</p><p>There are a few situations when it is especially important that you remember to ‘dismount’ (what it calls close) your encrypted volume:<br>- Dismount it when you walk away from your computer for any length of time. Even if you typically leave your computer running overnight, you need to ensure that you do not leave your sensitive files accessible to physical or remote intruders while you are gone.<br>- Dismount it before putting your computer to sleep.<br>- Dismount it before allowing someone else to handle your computer. When taking a laptop through a security checkpoint or border crossing, it is important that you disconnect all encrypted volumes and shut your computer down completely.<br>- Dismount it before inserting an untrusted USB memory stick or other external storage device, including those belonging to friends and colleagues.<br>- If you keep an encrypted volume on an external hard drive or a USB stick, remember that just removing the device may not immediately disconnect the volume. Even if you need to secure your files in a hurry, you have to dismount the volume properly, then disconnect the external drive or memory stick, then remove the device.</p><h1>A secret safe within a safe</h1><p>One of the weaknesses with some encryption tools is their visibility – you may be worried that someone could find the encrypted volume, see that you were trying to conceal information, and use intimidation, blackmail or interrogation to force you into opening it.</p><p>However TrueCrypt allows you to create a secret volume, inside your regular encrypted volume, to hide your most sensitive information. It is similar to installing a secret 'false bottom' inside your office safe. If an intruder steals your key, or intimidates you into giving them the safe's combination, they will find some convincing decoy material, but not the information that you truly care about protecting.</p><p>You open this secret volume by providing an alternate password that is different from the one you would normally use. Even if a technically sophisticated intruder gains access to the standard volume, he will be unable to prove that a hidden one exists.</p><h1>Hiding your encryption</h1><p>If you are concerned about encryption software being found on your computer regardless of what’s in it, there are a few tricks to help disguise TrueCrypt.</p><p>- You can rename your encrypted volume to look like a different type of file. Using the '.iso' file extension, to disguise it as a CD image, is one option that works well for large volumes of around 700 MB. Other extensions would be more realistic for smaller volumes.<br>- You can also rename the TrueCrypt program itself, assuming you have stored it as you would a regular file, rather than installing it as a program. The TrueCrypt Guide explains how to do this.</p><h1>When encryption is illegal</h1><p>Encryption is illegal in some countries, which means that downloading, installing or using software of this sort might be a crime in its own right. Any time that merely being associated with encryption software would be enough to expose you to accusations of criminal activity or espionage (regardless of what is actually inside your encrypted volumes), then you will have to think carefully about whether or not such tools are appropriate for your situation.</p><p>If that is the case, you have a few options:<br>- Store only non-confidential information<br>- Use a system of code words to protect key elements of your sensitive files<br>- Store all of your sensitive information in a secure webmail account – you would need a reliable network connection and an advanced understanding of computers and Internet services<br>- Keep sensitive information off of your computer by storing it on a USB stick or portable hard drive – carrying around sensitive, unencrypted information is usually a very bad idea so you would need to keep the device in a very secure place</p><h3>RELATED LESSONS/TOOLS</h3><p>- Managing Information Lesson<br>- Home/Office Section<br>- Malware Lesson<br>- TrueCrypt Tool Guide</p>"
                },
                {
                        "<h1>How to delete information securely</h1><p>Most of us think that a file on our computer is deleted once we put the file in our computer's trash folder and empty the trash; in reality, this does not actually delete files – it just makes them invisible to the user until the space they took up on your computer is overwritten with something else. This means that, with the right tools, your “deleted” files can often be retrieved.</p><img src=\"deleting1\"><p>The best way to delete a file forever, then, is to make sure it gets overwritten immediately.<br>This can be done easily using Eraser (for Windows) or Secure Delete (for Mac OS X), both of which are described below. Users of Linux and other open-source operating systems can use GNU shred, but this requires a more advanced technical proficiency.</p><img src=\"deleting2\"><p>Note that securely deleting data from solid state drives (SSDs), USB flash drives, and SD cards is very hard! The instructions below apply only to traditional disk drives. If you’re using an SSD or a USB flash drive, you can skip to the section about it below.</p><h1>Secure deletion on Windows</h1><p>On Windows, we suggest using Eraser. Eraser is a free/open source secure deletion tool for Windows, and is much better than the built-in tools. To use Eraser, first download the installer from its website; make sure to choose a “stable” build. After the file downloads, double-click on it to launch it and Run the file.</p><p>Once Eraser is installed, if you want to securely delete a single file or folder, simply:<br>- Right-click on the file or folder and choose Eraser > Erase from the right-click menu.</p><p>Alternatively, you may want to securely erase all the previously deleted data from your computer.<br>- Launch Eraser.<br>- Click the downward-pointing arrow next to “Erase Schedule” and choose “New Task.”<br>- In the “Task Properties” dialog that pops up, set the “Task Type” to “Run immediately.”<br>- Then click the “Add Data” button near the bottom of the dialog.<br>- In the new “Select Data to Erase” dialog that pops up, choose “Unused disk space” and make sure the correct disk drive is selected in the drop down box (most likely the “(C:)” drive).<br>- Click “OK” to exit both dialogs, and Eraser should start erasing.<br>- Once it’s done erasing, the task will disappear from the list of tasks in the “Erase Schedule.”</p><h1>Secure deletion on Mac OS X</h1><p>On OS X 10.4 and above, you can securely delete individual files by simply:<br>- Moving them to the Trash;<br>- Then selecting Finder > Secure Empty Trash.</p><p>Alternatively, you may want to securely erase all the previously deleted data from your computer. Apple's advice on this is to:<br>- Open Disk Utility (in Applications/Utilities);<br>- Choose Help > Disk Utility Help;<br>- Search for help on erasing free disk space.</p><h1>Limitations</h1><p>Unfortunately, there are limitations to secure deletion tools. Even if you follow the advice above and you’ve deleted all copies of a file, certain traces of deleted files, such as its name will probably continue to exist for some time on your computer. Overwriting the entire disk and installing a fresh operating system is the only way to be 100% certain that records of a file have been erased.</p><p>You may be wondering, \"Could I search the raw data on the disk to see if there are any copies of the data anywhere?\" The answer is yes and no. Searching the disk will tell you if the data is present in plaintext, but it won't tell you if some program has compressed or otherwise coded references to it. Also be careful that the search itself does not leave a record!</p><h1>Secure deletion when discarding old hardware</h1><p>If you want to finally throw a piece of hardware away or sell it on eBay, you'll want to make sure no one can retrieve your data from it. And even if you're not getting rid of it right away, if you have a computer that has reached the end of its life and is no longer in use, it's also safer to wipe the hard drive before stashing the machine in a corner or a closet. This can be done easily with a tool such as Darik's Boot and Nuke – our Tool Guide will run you through the steps.</p><h1>Discarding CD-ROMS</h1><p>When it comes to CD-ROMs, you should do the same thing you do with paper―shred them. There are inexpensive shredders that will chew up CD-ROMs. Never just throw a CD-ROM out in the rubbish unless you're absolutely sure there's nothing sensitive on it.</p><h1>Secure deletion on solid-state disks (SSDs), USB flash drives, and SD cards</h1><p>Unfortunately due to the way SSDs, USB flash drives, and SD cards work, it is difficult, if not impossible, to securely delete both individual files and free space. As a result your best bet in terms of protection is to use encryption—that way, even if the file is still on the disk, it will at least look like code to anyone who gets ahold of it and can’t force you to decrypt it. You can learn about how to use encryption in the Protecting Files lesson.</p><h3>RELATED LESSONS/TOOLS</h3><p>- Protecting Files</p>"
                },
                {
                        "",
                        "<p>Backing up is the copying and archiving of computer data so it can retrieve it if something happens to the original. Years of work can disappear in an instant as a result of theft, carelessness, confiscation, or breakage, so it is extremely important to have an up-to-date backup and a well-tested means of restoring it.</p><p>Creating an effective backup policy can be tricky for a few reasons:<br>- The need to store original data and backups in different physical locations;<br>- The importance of keeping backups confidential;<br>- The challenge of coordinating among different people who share information with one another using their own portable storage devices.</p><p>In addition to backup and file-recovery tactics, this lesson addresses two specific tools, Cobian Backup and Recuva.</p><h1>Identifying and organising your information</h1><p>The first step to formulating a backup policy is to figure out where all your personal and work information is currently located. This may include the following:<br>- Email may be stored on the provider's mail server, on your own computer, or both.<br>- Documents, address books, or chat histories on the computers you use, which may be in the office or at home.<br>- Information may also be stored on USB sticks, portable hard drives, or CDs.<br>- Contacts and important text messages on your mobile phone.<br>- Your website may contain important information or collection of work.<br>- Don't forget your non-digital information, such as paper notebooks, diaries and letters.</p><p>Next, you need to work out which of these files are 'master copies,' and which are duplicates. The master copy is generally the most up-to-date version of a file and is the one you will want to back-up.</p><p>You should make a table of all the information types you identified above and for each of them note:<br>- Whether that information is master copy or duplicate;<br>- The device or devices they are stored on;<br>- The physical location that the device is usually kept.</p><p>This table will help you see which of your information (or master copies) is only in one location and therefore vulnerable.</p><img src=\"backing1\"><h1>Your backup strategy</h1><p>To back up all of the data types listed above, you will need a combination of software and processes. Basically, you need to make sure that each data type is stored in at least two separate locations.</p><p>- <b>Electronic documents</b> - Create a full backup of the documents on your computer using a program like Cobian Backup, which is described in more detail below. Store the backup on something portable so that you can take it home or to some other safe location. External hard drives, CD/DVDs or USB memory sticks are possible choices. Because this category of data often contains the most sensitive information, it is important to protect your electronic document backups using encryption. You can learn how to do this in the Protecting Files lesson and in the TrueCrypt Guide.<br>- <b>Program databases</b> - If you use a calendar application or an electronic address book, for example, you will need to find the folder in which these programs store their data. Once you have determined the location of your program databases, you can back them up in the same way as electronic documents.<br>- <b>Email</b> - Rather than accessing your email only through a web browser, install an email client like Thunderbird and configure it to work with your account. The Thunderbird Guide explains in detail how to do this. Also most webmail services will provide instructions on how to use such programs and, often, how to import your email addresses into them. If you choose to move your old email messages to your computer so they are not stored on the server for security reasons, make sure that you include them in the backup of electronic documents described above.<br>- <b>Mobile phone contents</b> - To back up the phone numbers and text messages on your mobile phone, you can connect it to your computer using the appropriate software, which is generally available from the website of the company that manufactured your phone. You may need to buy a special USB cable to do this.<br>- <b>Printed documents</b> - Where possible, you should scan all of your important papers, then back them up along with your other electronic documents, as discussed above.</p><h1>Storage devices</h1><p> Before you can back up your data, you must decide what kind of storage device you will use.</p><p>- <b>USB sticks or external hard drives</b> – These are inexpensive, offer large capacity, and are easy to overwrite numerous times. USB sticks often have a lifetime of approximately ten years, with external hard drives lasting longer.<br>- <b>CDs</b> – CDs store around 700 Megabytes (MB) of data. You will need a CD burner and blank discs. If you want to erase a CD and update the files stored on it, you will need to have a CD-RW burner and rewritable CDs. All major operating systems, including Windows XP, now include built-in software that can write CDs and CD-RWs. These discs may begin to deteriorate after five or ten years.<br>- <b>DVDs</b> - DVDs store up to 4.7 Gigabytes (GB) of data. They work much like CDs but require slightly more expensive DVD or DVD-RW burner, and appropriate discs. As with a CD, the data written on a normal DVD will eventually begin to fade.<br>- <b>Remote server</b> - A well-maintained network backup server may have almost unlimited capacity, but the speed and stability of your own Internet connection will determine whether or not this is a realistic option. Keep in mind that running a backup server in your own office, while faster than copying information over the Internet, violates the requirement that you keep a copy of your important data in two different physical locations. There are free storage services on the Internet, as well, but you should very carefully consider the risks of putting your information online and you should always encrypt your backups before uploading them to servers run by organisations or individuals whom you do not know and trust.</p><img src=\"deleting2\"><h1>Backup Software</h1><p> Cobian Backup is a user-friendly tool that can be set to run automatically, at regularly scheduled times, and to include only files that have changed since your last backup. It can also compress backups to make them smaller. You can learn how to install and run it in our Cobian Backup Guide. </p><p>When using these backup tools, there are a few things you can do to help your backup system work smoothly:<br>- Organise the files on your computer. Try to move all of the folders that contain electronic documents you intend to back up into a single location, such as inside the My Documents folder.<br>- If you use software that stores its data in an application database, you should first determine the location of that database. If it is not in a convenient location, see if the program will allow you to choose a new location for its database. If it does, you can put it in the same folder as your electronic documents.<br>- Create a regular schedule to perform your backup.<br>- Try to establish procedures for all of the staff in your office who do not already have a reliable, secure backup policy. Help your colleagues understand the importance of this issue.<br>- Make sure to test the process of recovering data from your backup. Remember that, in the end, it is the restore procedure, not the backup procedure, which you really care about!</p><p>Once you have backed up your information or created a back-up process, you need to figure out a safe place to store it. Remember, this needs to be a different location to the one where the original information is! (i.e. if backing up your office files, the usb stick you use should not be kept in the office)</p><h1>Recovering from accidental file deletion</h1><p>When you delete a file in on your computer, it usually disappears from view, but its contents actually remain. Even after you empty the Recycle Bin, information from the files you deleted can usually still be found on the hard drive. See the Deleting lesson to learn more about this. Occasionally, if you accidentally delete an important file or folder, this security vulnerability can work to your advantage. There are several programs that can restore access to recently-deleted files, including a tool called Recuva - File Recovery, which you can learn how to use in our tool guide.</p><p>It is important that you do as little as possible with your computer between deleting a file and attempting to restore it. The longer you use your computer before attempting to restore the file, the less likely it is that you will succeed. This also means that you should use the portable version of Recuva instead of installing it after deleting an important file. (Or better – install it before anything happens!)</p><p>While it might sound like a lot of work to implement the policies and learn the tools described in this chapter, maintaining your backup strategy, once you have a system in place, is much easier than setting it up for the first time. And, given that backup may be the single most important aspect of data security, you can rest assured that going through this process is well worth the effort.</p><h3>RELATED LESSONS/TOOLS</h3><p>- Protecting Files Lesson<br>- Deleting Lesson<br>- TrueCrypt Guide<br>- Thunderbird Guide<br>- Cobian Backup Guide<br>- Recuva – File Recovery Guide</p>"
                }
        };

        public TabbedContentFragment() {
        }

        @Override
        public View onCreateView(LayoutInflater inflater, ViewGroup container,
                                 Bundle savedInstanceState) {
            View rootView = inflater.inflate(R.layout.fragment_tabbed_content,
                    container, false);

            int drawerItem = (int)((MainActivity) getActivity()).drawerItem;
            content = (TextView) rootView.findViewById(R.id.content);
            int difficulty = getArguments().getInt(ARG_DIFFICULTY_NUMBER, 1) - 1;
            if (contentHtml.length > drawerItem && contentHtml[drawerItem].length > difficulty) {
                String html = contentHtml[drawerItem][difficulty];
                html = html.replaceAll("\\<h1\\>", "<p><font color=\"#33b5e5\"><big><big>");
                html = html.replaceAll("\\</h1\\>", "</big></big></font></p>");
                html = html.replaceAll("\\<h2\\>", "<p><font color=\"#9ABE2E\"><big>");
                html = html.replaceAll("\\</h2\\>", "</big></font></p>");
                content.setText(Html.fromHtml(html, new Html.ImageGetter() {
                    @Override
                    public Drawable getDrawable(String source) {
                        Drawable d = getActivity().getResources().getDrawable(getActivity().getResources().getIdentifier(source, "drawable", BuildConfig.APPLICATION_ID));
                        d.setBounds(0, 0, getActivity().getWindowManager().getDefaultDisplay().getWidth(), d.getIntrinsicHeight() * getActivity().getWindowManager().getDefaultDisplay().getWidth() / d.getIntrinsicWidth());
                        return d;
                    }
                }, null));
            } else {
                content.setText("");
            }
            return rootView;
        }

    }

    public static class CheckItemFragment extends Fragment {

        private List<CheckItem> mCheckList;
        private ProgressBar checkBar;
        private TextView checkBarText;
        private CheckListAdapter cLAdapter;

        public CheckItemFragment() {}

        @Override
        public View onCreateView(LayoutInflater inflater, ViewGroup container,
                                 Bundle savedInstanceState) {
            View rootView = inflater.inflate(R.layout.fragment_check_item,
                    container, false);


            final long drawerItem = ((MainActivity) getActivity()).drawerItem;
            ListView contentBox = (ListView) rootView.findViewById(R.id.content_box);
            checkBar = (ProgressBar) rootView.findViewById(R.id.progress_bar_checked);
            checkBarText = (TextView) rootView.findViewById(R.id.check_bar_text);
            setProgressBarTo(0);
            final int diffArg = getArguments().getInt(ARG_DIFFICULTY_NUMBER, 1);
            ImageButton addItem = (ImageButton) rootView.findViewById(R.id.fab);
            addItem.setOnClickListener(new View.OnClickListener() {
                @Override
                public void onClick(View v) {
                    Global global = ((MainActivity) getActivity()).getGlobal();
                    if (!global.hasPasswordSet()) {
                        global.setPassword(getActivity());
                    } else {
                        AlertDialog.Builder alert = new AlertDialog.Builder(getActivity());
                        alert.setTitle("Add a new check item");
                        alert.setMessage("Set a meaningful message for the check item");
                        final EditText pwInput = new EditText(getActivity());
                        alert.setView(pwInput);
                        alert.setPositiveButton("Ok", new DialogInterface.OnClickListener() {
                            public void onClick(DialogInterface dialog, int whichButton) {
                                String pw = pwInput.getText().toString();
                                if (pw.length()>4) {
                                    CheckItem nItem = new CheckItem(pw, (int) drawerItem);
                                    nItem.setCustom(1);
                                    nItem.setDifficulty(diffArg);
                                    nItem.save();
                                    refreshCheckList(drawerItem, diffArg);
                                    dialog.dismiss();
                                    Toast.makeText(getActivity(), "You have added a new item.", Toast.LENGTH_SHORT).show();
                                } else {
                                    Toast.makeText(getActivity(), "The item text has to be longer than that", Toast.LENGTH_SHORT).show();
                                }
                            }
                        });
                        alert.setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
                            public void onClick(DialogInterface dialog, int whichButton) {
                                dialog.cancel();
                            }
                        });
                        alert.show();
                    }
                }
            });

            refreshCheckList(drawerItem, diffArg);
            cLAdapter = new CheckListAdapter(getActivity(), mCheckList, this);
            contentBox.setAdapter(cLAdapter);
            contentBox.setDivider(null);
            return rootView;
        }

        public void refreshCheckList(long category, int difficulty) {
            mCheckList = CheckItem.find(CheckItem.class, "category = ? and difficulty = ?", String.valueOf(category), String.valueOf(difficulty));
            if (cLAdapter != null) {
                cLAdapter.updateData(mCheckList);
            }
            if (mCheckList.size() > 0) {
                int selected = 0;
                for (CheckItem checkItem : mCheckList) {
                    if (checkItem.getValue()) selected++;
                }
                setProgressBarTo((int) Math.round(selected * 100.0 / mCheckList.size()));
            }
        }

        public void setProgressBarTo(int percent) {
            if (percent>=0 && percent<=100) {
                checkBar.setProgress(percent);
                checkBarText.setText(percent + "% filled");
            }
        }
    }

}